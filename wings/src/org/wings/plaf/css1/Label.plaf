<!-- -*- html -*- -->
<template name="LabelCG" for="org.wings.SLabel">

<property type="SIcon" name="clickableFallbackIcon">org/wings/icons/Pencil.gif</property>

void writeIcon(Device device, SIcon icon, SLabel label,
	       AnchorProperties anchor) 
     throws IOException {
     if (icon != null) {
        if (anchor != null) { 
	    %><a href="<%=anchor.getURL()%>"<%|target=anchor.getTarget()%>><% 
        }

        %><img<%
        if (label.isImageAbsBottom()) {
	    %> align="absbottom"<%
	}
        /*
	 * write optional attributes ..
	 */
        if (anchor != null) { %> border="0"<% }
        %><%|src=icon.getURL()%><%
        %><%|width=icon.getIconWidth()%><%
        %><%|height=icon.getIconHeight()%><%
        %> /><%

        if (anchor != null) {
	    %></a><%
        }     
     }
}

void writeText(Device device, SLabel label, AnchorProperties anchor)
    throws IOException {
    final String text = label.getText();
    if (text != null) {
       final boolean noBreak = label.isNoBreak();

        if (noBreak) { %><nobr><% }
        if (anchor != null) { 
	    %><a href="<%=anchor.getURL()%>"<%|target=anchor.getTarget()%>><% 
        }
	if (label.isEscapeSpecialChars()) {
            %><%=text%><%
        }
	else {
	    %><%#text%><% // write raw.
        }
        if (anchor != null) { %></a><% }
        if (noBreak) { %></nobr><% }
   }
}

<write>
<%
   String text = component.getText();
   SIcon  icon = component.getIcon();
   final int horizontalTextPosition = component.getHorizontalTextPosition();
   final int verticalTextPosition   = component.getVerticalTextPosition();
   final boolean noBreak = component.isNoBreak();
   final String style = ((component.getStyle() != null) 
			 ? component.getStyle().getName() 
			 : null);
   final String attr = ((component.getAttributes().size() > 0) 
			? ("_" + component.getUnifiedId()) 
			: null);
   final AnchorProperties anchor = AnchorRenderStack.get();

   /*
    * fallback icon in case we are clickable, but there is nothing
    * to click to (no icon nor text).
    */
    if (icon == null) {
	if (anchor != null && (text == null || text.length() == 0)) {
	    // no text either.
	    icon = clickableFallbackIcon;
	}
    }
   
   if (icon == null) {
      int spans = 0;
      if (style != null) {
          %><span class="<%=style%>"><%
          spans++;
      }
      if (attr != null) {
          %><span class="<%=attr%>"><%
          spans++;
      }
      writeText(device, component, anchor);
      if (spans == 1) { %></span><% }
      if (spans == 2) { %></span></span><% }
   }
   else if (text == null || text.length() == 0) {
      int spans = 0;
      if (style != null) {
          %><span class="<%=style%>"><%
          spans++;
      }
      if (attr != null) {
          %><span class="<%=attr%>"><%
          spans++;
      }
      writeIcon(device, icon, component, anchor);
      if (spans == 1) { %></span><% }
      if (spans == 2) { %></span></span><% }
   }
   else {
       %><table cellpadding="0"<%
       %><%|class=style%><%
       %>><%
       // if we are on the top, create a top row
       if (verticalTextPosition == TOP) {
	       %><tr><td<%
               %><%|class=attr%><%
               %>><% 
	       if (horizontalTextPosition == LEFT) { 
                  writeText(device, component, anchor);
	       }
	       %></td><td<%
               %><%|class=attr%><%
               %>><%
	       if (horizontalTextPosition == CENTER) { 
                  writeText(device, component, anchor);
	       }
	       %></td><td<%
               %><%|class=attr%><%
               %>><% 
	       if (horizontalTextPosition == RIGHT) {
                  writeText(device, component, anchor);
	       }
	       %></td></tr><%
       }

       // we always have a center row, since we have to write the icon
       if (verticalTextPosition == CENTER) {
	       %><tr><td<%
               %><%|class=attr%><%
               %>><%
	       if (horizontalTextPosition == LEFT) {
                  writeText(device, component, anchor);
	       }
	       %></td><td align="center"<%
               %><%|class=attr%><%
               %>><%
	       if (horizontalTextPosition == CENTER) { 
                  writeText(device, component, anchor);
                  %><br/><%
	       }
	       // the rendered icon in the center
	       writeIcon(device, icon, component, anchor);
	       %></td><td<%
               %><%|class=attr%><%
               %>><% 
	       if (horizontalTextPosition == RIGHT) { 
                  writeText(device, component, anchor);
	       }
	       %></td></tr><%
       } else {
	       %><tr><td></td><td align="center"<%
               %><%|class=attr%><%
               %>><%
	       writeIcon(device, icon, component, anchor); 
	       %></td><td></td></tr><%
       }

       // bottom row only, if text is there ..
       if (verticalTextPosition == BOTTOM) {
               %><tr><td<%
               %><%|class=attr%><%
               %>><% 
	       if (horizontalTextPosition == LEFT) {
                  writeText(device, component, anchor);
	       }
	       %></td><td<%
               %><%|class=attr%><%
               %>><%
	       if (horizontalTextPosition == CENTER) { 
                  writeText(device, component, anchor);
	       }
	       %></td><td<%
               %><%|class=attr%><%
               %>><% 
	       if (horizontalTextPosition == RIGHT) {
                  writeText(device, component, anchor);
	       }
	       %></td></tr><%
       } 
       %></table><%
   }
%></write>
</template>
